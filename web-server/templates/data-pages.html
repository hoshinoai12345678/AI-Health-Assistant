<!-- æ•™å¸ˆç«¯æ•°æ®ç®¡ç†é¡µé¢ -->
<div id="page-teacher-data" class="page">
    <div class="container">
        <div class="page-header">
            <h2>ğŸ“ æ•°æ®ç®¡ç†</h2>
            <p>ä¸Šä¼ å’Œç®¡ç†ä½“æµ‹æ•°æ®ã€åŠ¨ä½œåº“</p>
        </div>

        <div class="data-management-section">
            <div class="upload-card">
                <div class="upload-icon">ğŸ“Š</div>
                <h3>ä½“æµ‹æ•°æ®ä¸Šä¼ </h3>
                <p>ä¸Šä¼ ç­çº§å­¦ç”Ÿä½“æµ‹æ•°æ®ï¼ˆExcelæ ¼å¼ï¼‰</p>
                <button class="btn-primary" onclick="handleFileUpload('fitness')">
                    <span>ğŸ“¤</span> é€‰æ‹©æ–‡ä»¶ä¸Šä¼ 
                </button>
                <div class="upload-tips">
                    <small>æ”¯æŒæ ¼å¼ï¼š.xlsx, .xls, .csv</small>
                </div>
            </div>

            <div class="upload-card">
                <div class="upload-icon">ğŸ’ª</div>
                <h3>åŠ¨ä½œåº“ä¸Šä¼ </h3>
                <p>ä¸Šä¼ ä½“è‚²è®­ç»ƒåŠ¨ä½œåº“ï¼ˆExcelæ ¼å¼ï¼‰</p>
                <button class="btn-primary" onclick="handleFileUpload('exercises')">
                    <span>ğŸ“¤</span> é€‰æ‹©æ–‡ä»¶ä¸Šä¼ 
                </button>
                <div class="upload-tips">
                    <small>æ”¯æŒæ ¼å¼ï¼š.xlsx, .xls, .csv</small>
                </div>
            </div>
        </div>

        <div class="query-section">
            <h3>æ•°æ®æŸ¥è¯¢</h3>
            <div class="query-buttons">
                <button class="btn-secondary" onclick="queryStudentData()">
                    <span>ğŸ‘¤</span> æŸ¥è¯¢å­¦ç”Ÿæ•°æ®
                </button>
                <button class="btn-secondary" onclick="queryClassData()">
                    <span>ğŸ‘¥</span> æŸ¥è¯¢ç­çº§æ•°æ®
                </button>
            </div>
        </div>
    </div>
</div>

<!-- å­¦ç”Ÿç«¯æŸ¥è¯¢é¡µé¢ -->
<div id="page-student-query" class="page">
    <div class="container">
        <div class="page-header">
            <h2>ğŸ“‹ æˆ‘çš„ä½“æµ‹</h2>
            <p>æŸ¥çœ‹ä¸ªäººä½“æµ‹æˆç»©å’Œè®­ç»ƒå»ºè®®</p>
        </div>

        <div class="query-form">
            <div class="form-group">
                <label>å­¦å·</label>
                <input type="text" id="student-id-input" placeholder="è¯·è¾“å…¥å­¦å·" class="form-input">
            </div>
            <button class="btn-primary btn-block" onclick="queryStudentDataByInput()">
                <span>ğŸ”</span> æŸ¥è¯¢æˆ‘çš„æ•°æ®
            </button>
        </div>

        <div id="student-data-container" class="data-container"></div>
    </div>
</div>

<!-- å®¶é•¿ç«¯æŸ¥è¯¢é¡µé¢ -->
<div id="page-parent-query" class="page">
    <div class="container">
        <div class="page-header">
            <h2>ğŸ‘¶ å­©å­ä½“æµ‹</h2>
            <p>æŸ¥çœ‹å­©å­çš„ä½“æµ‹æˆç»©å’Œæˆé•¿å»ºè®®</p>
        </div>

        <div class="query-form">
            <div class="form-group">
                <label>å­©å­å­¦å·</label>
                <input type="text" id="child-id-input" placeholder="è¯·è¾“å…¥å­©å­çš„å­¦å·" class="form-input">
            </div>
            <button class="btn-primary btn-block" onclick="queryChildData()">
                <span>ğŸ”</span> æŸ¥è¯¢å­©å­æ•°æ®
            </button>
        </div>

        <div id="child-data-container" class="data-container"></div>
    </div>
</div>

<!-- åŠ è½½æç¤º -->
<div id="loading-overlay" class="loading-overlay">
    <div class="loading-spinner"></div>
    <div class="loading-text">åŠ è½½ä¸­...</div>
</div>

<!-- åº•éƒ¨å¯¼èˆªæ  -->
<div class="tab-bar">
    <div class="tab-item" data-page="home" onclick="navigateToHome()">
        <div class="tab-icon">ğŸ </div>
        <div class="tab-label">é¦–é¡µ</div>
    </div>
    <div class="tab-item" data-page="chat" onclick="navigateTo('chat')">
        <div class="tab-icon">ğŸ’¬</div>
        <div class="tab-label">AIåŠ©æ‰‹</div>
    </div>
    <div class="tab-item" data-page="data" onclick="navigateToData()">
        <div class="tab-icon">ğŸ“Š</div>
        <div class="tab-label">æ•°æ®</div>
    </div>
    <div class="tab-item" data-page="profile" onclick="navigateTo('profile')">
        <div class="tab-icon">ğŸ‘¤</div>
        <div class="tab-label">æˆ‘çš„</div>
    </div>
</div>

<script>
// å¯¼èˆªåˆ°é¦–é¡µ
function navigateToHome() {
    if (currentRole) {
        navigateTo(`${currentRole}-home`);
    } else {
        navigateTo('role-select');
    }
}

// å¯¼èˆªåˆ°æ•°æ®é¡µé¢
function navigateToData() {
    if (currentRole === 'teacher') {
        navigateTo('teacher-data');
    } else if (currentRole === 'student') {
        navigateTo('student-query');
    } else if (currentRole === 'parent') {
        navigateTo('parent-query');
    } else {
        navigateTo('role-select');
    }
}

// é€šè¿‡è¾“å…¥æ¡†æŸ¥è¯¢å­¦ç”Ÿæ•°æ®
async function queryStudentDataByInput() {
    const input = document.getElementById('student-id-input');
    const studentId = input.value.trim();
    
    if (!studentId) {
        showToast('è¯·è¾“å…¥å­¦å·', 'warning');
        return;
    }
    
    const data = await getStudentData(studentId);
    if (data) {
        displayStudentDataInContainer(data, 'student-data-container');
        
        // è·å–è®­ç»ƒæ¨è
        const recommendations = await getExerciseRecommendations(studentId);
        if (recommendations) {
            displayExerciseRecommendationsInContainer(recommendations, 'student-data-container');
        }
    }
}

// æŸ¥è¯¢å­©å­æ•°æ®
async function queryChildData() {
    const input = document.getElementById('child-id-input');
    const studentId = input.value.trim();
    
    if (!studentId) {
        showToast('è¯·è¾“å…¥å­©å­çš„å­¦å·', 'warning');
        return;
    }
    
    const data = await getStudentData(studentId);
    if (data) {
        displayStudentDataInContainer(data, 'child-data-container');
        
        // è·å–è®­ç»ƒæ¨è
        const recommendations = await getExerciseRecommendations(studentId);
        if (recommendations) {
            displayExerciseRecommendationsInContainer(recommendations, 'child-data-container');
        }
    }
}

// åœ¨å®¹å™¨ä¸­æ˜¾ç¤ºå­¦ç”Ÿæ•°æ®
function displayStudentDataInContainer(data, containerId) {
    const container = document.getElementById(containerId);
    if (!container) return;
    
    container.innerHTML = `
        <div class="data-card">
            <div class="data-header">
                <h4>åŸºæœ¬ä¿¡æ¯</h4>
            </div>
            <div class="data-content">
                <div class="data-item">
                    <span class="label">å­¦å·ï¼š</span>
                    <span class="value">${data.student_id}</span>
                </div>
                <div class="data-item">
                    <span class="label">å¹´çº§ï¼š</span>
                    <span class="value">${data.grade}</span>
                </div>
                <div class="data-item">
                    <span class="label">ç­çº§ï¼š</span>
                    <span class="value">${data.class}</span>
                </div>
                <div class="data-item">
                    <span class="label">æ€§åˆ«ï¼š</span>
                    <span class="value">${data.gender}</span>
                </div>
                <div class="data-item">
                    <span class="label">èº«é«˜ï¼š</span>
                    <span class="value">${data.basic_info.height} cm</span>
                </div>
                <div class="data-item">
                    <span class="label">ä½“é‡ï¼š</span>
                    <span class="value">${data.basic_info.weight} kg (${data.basic_info.weight_level})</span>
                </div>
            </div>
        </div>
        
        <div class="data-card">
            <div class="data-header">
                <h4>ä½“æµ‹æˆç»©</h4>
            </div>
            <div class="data-content">
                ${renderTestItem('è‚ºæ´»é‡', data.test_results.lung_capacity)}
                ${renderTestItem('50ç±³è·‘', data.test_results.run_50m)}
                ${renderTestItem('åä½ä½“å‰å±ˆ', data.test_results.sit_reach)}
                ${renderTestItem('ä»°å§èµ·å', data.test_results.sit_up)}
                ${renderTestItem('è·³ç»³', data.test_results.rope_skip)}
                ${renderTestItem('ç«‹å®šè·³è¿œ', data.test_results.standing_jump)}
            </div>
        </div>
        
        <div class="data-card">
            <div class="data-header">
                <h4>æ€»åˆ†</h4>
            </div>
            <div class="data-content">
                <div class="score-summary">
                    <div class="score-item">
                        <div class="score-label">æ ‡å‡†åˆ†</div>
                        <div class="score-value">${data.total.standard_score}</div>
                    </div>
                    <div class="score-item">
                        <div class="score-label">é™„åŠ åˆ†</div>
                        <div class="score-value">${data.total.bonus_score}</div>
                    </div>
                    <div class="score-item highlight">
                        <div class="score-label">æ€»åˆ†</div>
                        <div class="score-value">${data.total.total_score}</div>
                    </div>
                    <div class="score-item">
                        <div class="score-label">ç­‰çº§</div>
                        <div class="score-value level-${data.total.level}">${data.total.level}</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="recommendations-${containerId}"></div>
    `;
}

// åœ¨å®¹å™¨ä¸­æ˜¾ç¤ºè®­ç»ƒæ¨è
function displayExerciseRecommendationsInContainer(data, containerId) {
    const container = document.getElementById(`recommendations-${containerId}`);
    if (!container) return;
    
    let html = '<div class="data-card"><div class="data-header"><h4>è®­ç»ƒå»ºè®®</h4></div><div class="data-content">';
    
    if (data.weak_items && data.weak_items.length > 0) {
        html += `
            <div class="weak-items">
                <p><strong>éœ€è¦åŠ å¼ºçš„é¡¹ç›®ï¼š</strong></p>
                <div class="weak-tags">
                    ${data.weak_items.map(item => `<span class="weak-tag">${item}</span>`).join('')}
                </div>
            </div>
        `;
    }
    
    if (data.recommended_exercises && data.recommended_exercises.length > 0) {
        html += '<div class="exercise-list">';
        data.recommended_exercises.forEach(ex => {
            html += `
                <div class="exercise-card">
                    <div class="exercise-header">
                        <h5>${ex.name}</h5>
                        <span class="difficulty-badge">${ex.difficulty}</span>
                    </div>
                    <div class="exercise-body">
                        <p>${ex.description.substring(0, 100)}...</p>
                        <div class="exercise-tags">
                            <span class="tag">æå‡ï¼š${ex.improve_test}</span>
                        </div>
                    </div>
                </div>
            `;
        });
        html += '</div>';
    } else {
        html += '<p class="no-data">æš‚æ— æ¨èåŠ¨ä½œ</p>';
    }
    
    html += '</div></div>';
    container.innerHTML = html;
}
</script>
